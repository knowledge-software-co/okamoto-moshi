# テスト - testing

今回「なんちゃってクリーンアーキテクチャ」を実装するにあたり、機能テスト（Feature Test）を中心に進めていきます。<br>

- [「なんちゃってクリーンアーキテクチャ」でテストどうするの？](https://zenn.dev/mpyw/articles/ce7d09eb6d8117#%E3%83%86%E3%82%B9%E3%83%88%E3%81%A9%E3%81%86%E3%81%99%E3%82%8B%E3%81%AE%EF%BC%9F)

## テストの種類

Laravelで行うテストには、以下のような種類があります。<br>

- 単体テスト（Unit Test）
- 機能テスト（Feature Test）
- ブラウザテスト（Browser Test）

### 単体テスト（Unit Test）

`/tests/Unit` 配下にテストを配置する。<br>
一番粒度の細かいテスト。<br>
<br>
Service、Model、Middleware、Policyなど、<br>
自分で作ったクラス１つ１つと対応するように<br>
テストクラス（ファイル）を１つ１つ作る。<br>
<br>
その対象クラスのメソッド１つ１つの動作を検証するための<br>
テストケースをコードに書いていく。<br>
<br>
Controllerクラスのテストは<br>
UnitTestではなくFeatureTestとするほうがしっくりくる。<br>

### 機能テスト（Feature Test）

`/tests/Feature` 配下にテストを配置する。<br>
UnitTestより粒度を大きくしたテスト。<br>
<br>
１つのHTTPリクエスト単位の動きをテストする。<br>
=ルーティング１つごとにテストクラス（ファイル）を作る<br>
=コントローラのアクションメソッド単位でのテスト<br>
<br>
UnitTestでテストした各クラスを結合した状態で<br>
コントローラの動き（つまりリクエストを受けてレスポンスを返すまで）をテストするというイメージ。<br>

１つのコントローラアクションに対応したテストクラス（ファイル）の中で、<br>
・ログインした状態でアクセス時の動作<br>
・未ログインアクセス時の動作<br>
・検索パラメータ付けたアクセス時の動作<br>
・ユーザに特定ロールを付けた状態の動作<br>
など１つ１つのケースをテストケースとしてコードを書く。<br>

### ブラウザテスト（Browser Test）

`/tests/Browser` 配下にテストを配置する。<br>
<br>
実際にブラウザを使って画面にリクエスト、<br>
ボタンをクリック、<br>
マウスホバー、<br>
フォーム送信などの操作をするテストをコードで実行できる。<br>
<br>
FeatureTestにさらに<br>
・複数HTTPリクエストの遷移<br>
・画面操作時のJsの動作<br>
のような観点を加えてテストできるイメージ。<br>
<br>
Unit、FeatureはPHPUnitで動作するテストなのに対し、<br>
BrowserTestはlaravel/duskというパッケージを使ったテスト。<br>

## テストの実行

テストの実行前に、テストデータの準備が必要です。<br>
テストデータの準備は、`--env=testing` オプションを付けてマイグレーションを実行します。<br>
`task test` コマンドを実行すると、テストデータの準備とテストが実行されます。<br>
各テストを個別に実行したい場合は `Taskfile.yml` を参考にしてください。<br>

## テストマトリクス・直交表

テストの目的はバグを洗い出すことです。<br>
できるだけバグを出すことを目標にしてください。<br>
<br>
テストケースの洗い出しにおいて、テストマトリクスと直交表の概念は理解しておいてください。<br>
テストケースを作成する際に、テストマトリクスや直交表を利用することで、テストケースの漏れを防ぐことができます。<br>
<br>
正常系のみではなく、異常系のテストケースも作成してください。<br>
<br>
不具合は境界値で発生しやすいと言われています。<br>
「境界値分析」の概念も理解しておいてください。<br>

## テスト自動化

テスト自動化は、テスト工数を削減するために重要です。<br>
下記ページを参考に、テスト自動化を進めてください。<br>

- [テスト自動化 - Testing Automation](/docs/cicd/test/index.md)

## 参考

- [単体試験の良き友、マトリクス表の作り方](https://zenn.dev/unsese/articles/f6f65cfb17659c9d9c08)
- [テストパターンを効率化！直交表でテスト工数を最低限に！](https://geechs-job.com/tips/details/34)
- [第100回：　組み合わせテスト（直交表）](https://note.com/akiyama924/n/n6a02ee6cd6f9)
- [境界値分析とは？流れやおさえておきたいポイントをわかりやすく解説](https://service.shiftinc.jp/column/4792/)
